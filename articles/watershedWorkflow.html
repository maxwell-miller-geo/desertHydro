<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>watershedWorkflow • desertHydro</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="watershedWorkflow">
<meta property="og:description" content="desertHydro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">desertHydro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/desertHydro-Template.html">desertHydro-Template</a>
    </li>
    <li>
      <a href="../articles/watershedWorkflow.html">watershedWorkflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>watershedWorkflow</h1>
            
      
      
      <div class="hidden name"><code>watershedWorkflow.Rmd</code></div>

    </div>

    
    
<!-- $$(K_{macro} -  K_{FieldCond}) {\frac{W_{surf}-Field_{cap}}{d_{soil}}} ({\frac{Sat_{mc} - Field_{cap}}{d_{soil} + K_{FieldCond}}})^{-1}$$ -->
<!-- $${\frac{W_{surf}-Field_{cap}}{d_{soil}}}$$ -->
<!-- $$ {\frac{Sat_{mc} - Field_{cap}}{d_{soil} + K_{FieldCond}}$$ -->
<div class="section level2">
<h2 id="load-in-the-necessary-libraries">Load in the necessary libraries<a class="anchor" aria-label="anchor" href="#load-in-the-necessary-libraries"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">desertHydro</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># For plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span> <span class="co"># For animations</span></span>
<span><span class="co">#require(whitebox)</span></span>
<span><span class="fu">whitebox</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whitebox/man/wbt_init.html" class="external-link">wbt_init</a></span><span class="op">(</span></span>
<span>  exe_path <span class="op">=</span> <span class="fu">whitebox</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whitebox/man/wbt_init.html" class="external-link">wbt_exe_path</a></span><span class="op">(</span>shell_quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  check_version <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-set-up">Model Set-up<a class="anchor" aria-label="anchor" href="#model-set-up"></a>
</h2>
<p>The desertHydro package is split into three levels.</p>
<div class="section level3">
<h3 id="pre-process-create-and-gather-necessary-files">1 Pre-process: Create and gather necessary files<a class="anchor" aria-label="anchor" href="#pre-process-create-and-gather-necessary-files"></a>
</h3>
<p>Model Folder -&gt; where to save the outputs from the model
WatershedElements Folder -&gt; folder containing the necessary inputs
for the model run.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Important steps</span></span>
<span></span>
<span><span class="va">ModelFolder</span> <span class="op">&lt;-</span> <span class="st">"ModelFolder"</span> <span class="co"># replace path to folder where model is saved</span></span>
<span><span class="co">#ModelFolder &lt;- r"(C:\PackageDev\desertHydro\ModelElementsTest)" # &lt;- Example</span></span>
<span></span>
<span><span class="co">#WatershedElements &lt;- "./inst/extdata/DemoElements" # replace this with your watershed</span></span>
<span><span class="va">WatershedElements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"dem.tif"</span>, package <span class="op">=</span> <span class="st">"desertHydro"</span><span class="op">)</span><span class="op">)</span> <span class="co"># replace this with your watershedelements folder</span></span>
<span><span class="co"># Checking model folder</span></span>
<span><span class="co"># WatershedElements &lt;- r"(C:\PackageDev/desertHydro/inst/extdata/DemoElements/)" # replace this with your watershed elements folder</span></span></code></pre></div>
<p>The priority of the model is to utilize the intersection of land
cover types, soil profiles from soil databases, and adjustable tables
(excel files) to model a particular rainfall event.</p>
<p>Necessary Inputs: 1) DEM or digital elevation file 2) Manning’s n or
surface roughness map (.tif or .shp) embedded within land cover file
With these two elements, the model can run on impervious mode
(impervious = T)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">demFile</span> <span class="op">&lt;-</span> <span class="st">"dem.tif"</span> <span class="co"># DEM file to simulate over - should be named dem.tif</span></span>
<span></span>
<span><span class="co"># Check if watershed elements folder exists</span></span>
<span><span class="va">WatershedElements</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folderCheck.html">folderCheck</a></span><span class="op">(</span><span class="va">WatershedElements</span>, <span class="va">demFile</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="st">"test-boundary.shp"</span> <span class="co"># Name of shapefile for outline</span></span>
<span><span class="va">landCoverFile</span> <span class="op">&lt;-</span> <span class="st">"soils.shp"</span> <span class="co"># name of soils data</span></span>
<span><span class="va">LandCoverCharacteristics</span> <span class="op">&lt;-</span> <span class="st">"LandCoverCharacteristics_Soils.xlsx"</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="st">"MUSYM"</span> <span class="co"># key is present in both the landcoverfile and the land cover characteristics</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="note">Note:<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>One of the key aspects of the map is to ensure that the soil
characteristics can be cross referenced to an input data table. The
three things that need to be present when adding soil characteristics.
### 1) Land cover spatial file: .shp or .tif ### 2) Land cover
characteristics: excel file containing soil depth characteristics ### 3)
Key: a character string that is present in both the attribute table of
the spatial file and the excel file.</p>
<div class="section level3">
<h3 id="rainfall-event-elements">Rainfall event elements<a class="anchor" aria-label="anchor" href="#rainfall-event-elements"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Optional - if dates present must be in YYYY-MM-DD format</span></span>
<span><span class="va">rainFile</span> <span class="op">&lt;-</span> <span class="st">"USGS_Rain_2001_2021.xlsx"</span></span>
<span><span class="va">dischargeFile</span> <span class="op">&lt;-</span> <span class="st">"example_discharge.csv"</span></span>
<span><span class="va">discharge</span> <span class="op">=</span> <span class="cn">F</span> <span class="co"># If TRUE, expects discharge present in file</span></span>
<span></span>
<span><span class="co"># If rainfall method is synthetic - uses 1/2 inch - 15 minute storm</span></span>
<span><span class="va">rainfall_method</span> <span class="op">&lt;-</span> <span class="st">"synthetic"</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-elements">Model elements<a class="anchor" aria-label="anchor" href="#model-elements"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># grid cell length - assumes uniform grid</span></span>
<span><span class="va">store</span> <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="va">time_step</span> <span class="op">&lt;-</span> <span class="fl">.1</span> <span class="co"># time step in minutes</span></span>
<span><span class="va">simulation_length</span> <span class="op">&lt;-</span>  <span class="fl">1</span> <span class="co"># time length in minutes</span></span>
<span><span class="va">impervious</span> <span class="op">&lt;-</span>  <span class="co"># no infiltration</span></span>
<span><span class="va">overwrite</span> <span class="op">&lt;-</span> <span class="cn">T</span> <span class="co"># overwrite previous inputs in both watershed elements and model folder</span></span>
<span><span class="va">write</span> <span class="op">&lt;-</span> <span class="cn">T</span> <span class="co"># create graphs and write outputs to model folder</span></span>
<span><span class="va">restartModel</span> <span class="op">&lt;-</span> <span class="cn">F</span> <span class="co"># If model is paused mid-run, can be restarted with same inputs</span></span>
<span><span class="va">gif</span> <span class="op">&lt;-</span> <span class="cn">F</span> <span class="co"># If TRUE, gif's will be created automatically. Can be created at the end</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-if-necessary-files-are-present">Check if necessary files are present<a class="anchor" aria-label="anchor" href="#check-if-necessary-files-are-present"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if the necessary folders are present</span></span>
<span><span class="va">foldersToCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">WatershedElements</span><span class="op">)</span></span>
<span><span class="va">folders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">foldersToCheck</span>, FUN <span class="op">=</span> <span class="va">file.exists</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">folders</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"All folders are not found. Here is a list of folders not found."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">folders</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Check if the necessary files are present</span></span>
<span><span class="va">filesToCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">demFile</span>, <span class="va">boundary</span>, <span class="va">landCoverFile</span>, <span class="va">LandCoverCharacteristics</span>, <span class="va">rainFile</span>, <span class="va">dischargeFile</span><span class="op">)</span></span>
<span><span class="va">filesCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">WatershedElements</span>, <span class="va">filesToCheck</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">file.exists</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">filesCheck</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"All files are not found. Here is a list of the files present."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filesCheck</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"All files found."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-run---off-and-running">2 Model Run - off and running<a class="anchor" aria-label="anchor" href="#model-run---off-and-running"></a>
</h2>
<p>The model will create files within the Model Folder was it runs. The
length of simulation is based on the size of the grid, the initial
timestep, and the duration. It is always encouraged to run a small scale
version in both space and time to determine if things are working
properly.</p>
</div>
<div class="section level2">
<h2 id="post-processing">3 Post processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h2>
<p>After the model has run, there are many files that are present within
the Model Folder that can be viewed in-situ or loaded into R for
viewing.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rain file to grab the necessary rainfall method</span></span>
<span><span class="co">#rain_file &lt;- desertHydro:::rainfallMethodCheck(ModelFolder, rainfall_method)</span></span>
<span><span class="va">gifs</span> <span class="op">&lt;-</span> <span class="fu">desertHydro</span><span class="fu">:::</span><span class="fu">gifCreation</span><span class="op">(</span><span class="va">ModelFolder</span>, <span class="va">rainfall_method</span>, discharge <span class="op">=</span> <span class="cn">F</span>, saveGraph <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="surface-gif">Surface gif<a class="anchor" aria-label="anchor" href="#surface-gif"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gifs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># surface gif</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="velocity-gif">Velocity gif<a class="anchor" aria-label="anchor" href="#velocity-gif"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gifs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># velocity gif</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maxwell Miller.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
