<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="desertHydro">
<title>watershedWorkflow • desertHydro</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="watershedWorkflow">
<meta property="og:description" content="desertHydro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">desertHydro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CloudComputing.html">CloudComputing</a>
    <a class="dropdown-item" href="../articles/desertHydro-Template.html">desertHydro-Template</a>
    <a class="dropdown-item" href="../articles/Elevation_Adjustments_in_Stream_Networks.html">Elevation Adjustments in Stream Networks</a>
    <a class="dropdown-item" href="../articles/watershedWorkflow.html">watershedWorkflow</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>watershedWorkflow</h1>
            
      
      
      <div class="d-none name"><code>watershedWorkflow.Rmd</code></div>
    </div>

    
    
<!-- $$(K_{macro} -  K_{FieldCond}) {\frac{W_{surf}-Field_{cap}}{d_{soil}}} ({\frac{Sat_{mc} - Field_{cap}}{d_{soil} + K_{FieldCond}}})^{-1}$$ -->
<!-- $${\frac{W_{surf}-Field_{cap}}{d_{soil}}}$$ -->
<!-- $$ {\frac{Sat_{mc} - Field_{cap}}{d_{soil} + K_{FieldCond}}$$ -->
<p>The purpose of this package is to provide a method of computational
hydrology for arid regions. Arid regions provide unique challenge to
hydrological modeling ranging from very steep terrain with canyons and
cliffs, lack of detailed soil data and land cover data, complex
interactions between infiltration and lack of detailed rainfall
data.</p>
<p>The utility of the desertHydro model is built upon the integration of
field measurements, e.i., rainfall and stream gauge data, with remotely
sensed or publically available data.</p>
<p>Some of the data that can be utilized within this package: Rainfall
data: <a href="https://www.goes-r.gov/" class="external-link uri">https://www.goes-r.gov/</a> Some information about GOES
files: <a href="https://docs.opendata.aws/noaa-goes16/cics-readme.html#about-the-data" class="external-link uri">https://docs.opendata.aws/noaa-goes16/cics-readme.html#about-the-data</a></p>
<div class="section level2">
<h2 id="load-in-the-necessary-libraries">Load in the necessary libraries<a class="anchor" aria-label="anchor" href="#load-in-the-necessary-libraries"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://maxwell-miller-geo.github.io/desertHydro/" class="external-link">desertHydro</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># For plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span> <span class="co"># For animations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/opengeos/whiteboxR" class="external-link">whitebox</a></span><span class="op">)</span></span>
<span><span class="co">#require(whitebox)</span></span>
<span><span class="fu">whitebox</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whitebox/man/wbt_init.html" class="external-link">wbt_init</a></span><span class="op">(</span></span>
<span>  exe_path <span class="op">=</span> <span class="fu">whitebox</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whitebox/man/wbt_init.html" class="external-link">wbt_exe_path</a></span><span class="op">(</span>shell_quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  check_version <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-set-up">Model Set-up<a class="anchor" aria-label="anchor" href="#model-set-up"></a>
</h2>
<p>The desertHydro package is split into three levels.</p>
<div class="section level3">
<h3 id="pre-process-create-and-gather-necessary-files">1 Pre-process: Create and gather necessary files<a class="anchor" aria-label="anchor" href="#pre-process-create-and-gather-necessary-files"></a>
</h3>
<p>Model Folder -&gt; where to save the outputs from the model
WatershedElements Folder -&gt; folder containing the necessary inputs
for the model run.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Important steps</span></span>
<span></span>
<span><span class="va">ModelFolder</span> <span class="op">&lt;-</span> <span class="st">"ModelFolder"</span> <span class="co"># replace path to folder where model is saved</span></span>
<span><span class="va">ModelFolder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#ModelFolder &lt;- r"(C:\PackageDev\desertHydro\ModelElementsTest)" # &lt;- Example</span></span>
<span></span>
<span><span class="co">#WatershedElements &lt;- "./inst/extdata/DemoElements" # replace this with your watershed</span></span>
<span><span class="va">WatershedElements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"dem.tif"</span>, package <span class="op">=</span> <span class="st">"desertHydro"</span><span class="op">)</span><span class="op">)</span> <span class="co"># replace this with your watershedelements folder</span></span>
<span><span class="co"># Checking model folder</span></span>
<span><span class="co"># WatershedElements &lt;- r"(C:\PackageDev/desertHydro/inst/extdata/DemoElements/)" # replace this with your watershed elements folder</span></span></code></pre></div>
<p>The priority of the model is to utilize the intersection of land
cover types, soil profiles from soil databases, and adjustable tables
(excel files) to model a particular rainfall event.</p>
<p>Necessary Inputs: 1) DEM or digital elevation file 2) Manning’s n or
surface roughness map (.tif or .shp) embedded within land cover file
With these two elements, the model can run on impervious mode
(impervious = T)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">demFile</span> <span class="op">&lt;-</span> <span class="st">"dem.tif"</span> <span class="co"># DEM file to simulate over - should be named smooth/dem.tif</span></span>
<span></span>
<span><span class="co"># Check if watershed elements folder exists</span></span>
<span><span class="va">WatershedElements</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/folderCheck.html">folderCheck</a></span><span class="op">(</span><span class="va">WatershedElements</span>, <span class="va">demFile</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="st">"test-boundary.shp"</span> <span class="co"># Name of shapefile for outline</span></span>
<span><span class="va">landCoverFile</span> <span class="op">&lt;-</span> <span class="st">"soils.shp"</span> <span class="co"># name of soils data</span></span>
<span><span class="va">LandCoverCharacteristics</span> <span class="op">&lt;-</span> <span class="st">"LandCoverCharacteristics_Soils.xlsx"</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="st">"MUSYM"</span> <span class="co"># key is present in both the landcoverfile and the land cover characteristics</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="note">Note:<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>One of the key aspects of the map is to ensure that the soil
characteristics can be cross referenced to an input data table. The
three things that need to be present when adding soil characteristics.
### 1) Land cover spatial file: .shp or .tif ### 2) Land cover
characteristics: excel file containing soil depth characteristics ### 3)
Key: a character string that is present in both the attribute table of
the spatial file and the excel file.</p>
<div class="section level3">
<h3 id="rainfall-event-elements">Rainfall event elements<a class="anchor" aria-label="anchor" href="#rainfall-event-elements"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Optional - if dates present must be in YYYY-MM-DD format</span></span>
<span><span class="va">rainFile</span> <span class="op">&lt;-</span> <span class="st">"USGS_Rain_2001_2021.xlsx"</span></span>
<span><span class="va">dischargeFile</span> <span class="op">&lt;-</span> <span class="st">"example_discharge.csv"</span></span>
<span><span class="va">discharge</span> <span class="op">=</span> <span class="cn">F</span> <span class="co"># If TRUE, expects discharge present in file</span></span>
<span></span>
<span><span class="co"># If rainfall method is synthetic - uses 1/2 inch - 15 minute storm</span></span>
<span><span class="va">rainfall_method</span> <span class="op">&lt;-</span> <span class="st">"synthetic"</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-elements">Model elements<a class="anchor" aria-label="anchor" href="#model-elements"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># grid cell length - assumes uniform grid</span></span>
<span><span class="va">store</span> <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="va">time_step</span> <span class="op">&lt;-</span> <span class="fl">.1</span> <span class="co"># time step in minutes</span></span>
<span><span class="va">simulation_length</span> <span class="op">&lt;-</span>  <span class="fl">1</span> <span class="co"># time length in minutes</span></span>
<span><span class="va">impervious</span> <span class="op">&lt;-</span>  <span class="co"># no infiltration</span></span>
<span><span class="va">overwrite</span> <span class="op">&lt;-</span> <span class="cn">T</span> <span class="co"># overwrite previous inputs in both watershed elements and model folder</span></span>
<span><span class="va">write</span> <span class="op">&lt;-</span> <span class="cn">T</span> <span class="co"># create graphs and write outputs to model folder</span></span>
<span><span class="va">restartModel</span> <span class="op">&lt;-</span> <span class="cn">F</span> <span class="co"># If model is paused mid-run, can be restarted with same inputs</span></span>
<span><span class="va">gif</span> <span class="op">&lt;-</span> <span class="cn">F</span> <span class="co"># If TRUE, gif's will be created automatically. Can be created at the end</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-if-necessary-files-are-present">Check if necessary files are present<a class="anchor" aria-label="anchor" href="#check-if-necessary-files-are-present"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if the necessary folders are present</span></span>
<span><span class="va">foldersToCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">WatershedElements</span><span class="op">)</span></span>
<span><span class="va">folders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">foldersToCheck</span>, FUN <span class="op">=</span> <span class="va">file.exists</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">folders</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"All folders are not found. Here is a list of folders not found."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">folders</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Check if the necessary files are present</span></span>
<span><span class="va">filesToCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">demFile</span>, <span class="va">boundary</span>, <span class="va">landCoverFile</span>, <span class="va">LandCoverCharacteristics</span>, <span class="va">rainFile</span>, <span class="va">dischargeFile</span><span class="op">)</span></span>
<span><span class="va">filesCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">WatershedElements</span>, <span class="va">filesToCheck</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">file.exists</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">filesCheck</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"All files are not found. Here is a list of the files present."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filesCheck</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"All files found."</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="model-run---off-and-running">2 Model Run - off and running<a class="anchor" aria-label="anchor" href="#model-run---off-and-running"></a>
</h2>
<p>The model will create files within the Model Folder where it runs.
The length of simulation is based on the size of the grid, the initial
timestep, and the duration. It is always encouraged to run a small scale
version in both space and time to determine if things are working
properly.</p>
</div>
<div class="section level2">
<h2 id="post-processing">3 Post processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h2>
<p>After the model has run, there are many files that are present within
the Model Folder that can be viewed in-situ or loaded into R for
viewing.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rain file to grab the necessary rainfall method</span></span>
<span><span class="co">#rain_file &lt;- desertHydro:::rainfallMethodCheck(ModelFolder, rainfall_method)</span></span>
<span><span class="va">gifs</span> <span class="op">&lt;-</span> <span class="fu">desertHydro</span><span class="fu">:::</span><span class="fu">gifCreation</span><span class="op">(</span><span class="va">ModelFolder</span>, <span class="va">rainfall_method</span>, discharge <span class="op">=</span> <span class="cn">F</span>, saveGraph <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="surface-gif">Surface gif<a class="anchor" aria-label="anchor" href="#surface-gif"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gifs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># surface gif</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="velocity-gif">Velocity gif<a class="anchor" aria-label="anchor" href="#velocity-gif"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gifs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># velocity gif</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maxwell Miller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
